<div class="pagetitle">
    <h1>Dashboard</h1>
    <nav>
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a asp-area="AdminPanel" asp-controller="User" asp-action="Index">Home</a></li>
            <li class="breadcrumb-item active">Dashboard</li>
        </ol>
    </nav>
</div><!-- End Page Title -->

<section class="section dashboard">
    <div class="row">

        <!-- Left side columns -->
        <div class="col-lg-8">
            <div class="row">

                <!-- Sales Card -->
                <div class="col-xxl-4 col-md-6">
                    <div class="card info-card sales-card">
                        <div class="filter">
                            <a class="icon" href="#" data-bs-toggle="dropdown"><i class="bi bi-three-dots"></i></a>
                            <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow">
                                <li class="dropdown-header text-start">
                                    <h6>Filter</h6>
                                </li>
                                <li><a class="dropdown-item" href="#" onclick="fetchSalesData('today')">Today</a></li>
                                <li><a class="dropdown-item" href="#" onclick="fetchSalesData('month')">This Month</a></li>
                                <li><a class="dropdown-item" href="#" onclick="fetchSalesData('year')">This Year</a></li>
                            </ul>
                        </div>

                        <div class="card-body">
                            <h5 class="card-title">Sales <span id="time-frame">| Today</span></h5>

                            <div class="d-flex align-items-center">
                                <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                                    <i class="bi bi-cart"></i>
                                </div>
                                <div class="ps-3">
                                    <h6 id="sales-count">0</h6> <!-- Satış sayısı buraya dinamik olarak gelecek -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div><!-- End Sales Card -->
                <!-- Revenue Card -->
                <div class="col-xxl-4 col-md-6">
                    <div class="card info-card revenue-card">

                        <div class="card-body">
                            <h5 class="card-title">Revenue</h5>

                            <div class="d-flex align-items-center">
                                <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                                    <i class="bi bi-currency-dollar"></i>
                                </div>
                                <div class="ps-3">
                                    <h6 id="revenue-amount">$0.00</h6> <!-- Toplam gelir burada dinamik olarak gösterilecek -->

                                </div>
                            </div>
                        </div>

                    </div>
                </div><!-- End Revenue Card -->
                <!-- Customers Card -->
                <div class="col-xxl-4 col-xl-12">

                    <div class="card info-card customers-card">

                        <div class="card-body">
                            <h5 class="card-title">Customers</h5>

                            <div class="d-flex align-items-center">
                                <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                                    <i class="bi bi-people"></i>
                                </div>
                                <div class="ps-3">
                                    <h6 id="person-count">0</h6>

                                </div>
                            </div>
                        </div>
                    </div>

                </div><!-- End Customers Card -->
                <!-- Recent Sales -->
                <div class="col-12">
                    <div class="card recent-sales overflow-auto">
                        <div class="card-body">
                            <h5 class="card-title">Recent Sales</h5>
                            <table class="table table-borderless">
                                <thead>
                                    <tr>
                                        <th scope="col">ProductId</th>
                                        <th scope="col">Customer</th>
                                        <th scope="col">Product</th>
                                        <th scope="col">Price</th>
                                        <th scope="col">Status</th>
                                    </tr>
                                </thead>
                                <tbody id="sales-data-body">
                                    <!-- Dinamik olarak doldurulacak -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <!-- End Recent Sales -->
                <!-- Top Selling -->
                <div class="col-12">
                    <div class="card recent-sales overflow-auto">
                        <div class="card-body">
                            <h5 class="card-title">Top Selling</h5>
                            <table class="table table-borderless">
                                <thead>
                                    <tr>
                                        <th scope="col">Preview</th>
                                        <th scope="col">Product</th>
                                        <th scope="col">Price</th>
                                        <th scope="col">Sold</th>
                                        <th scope="col">Revenue</th>
                                    </tr>
                                </thead>
                                <tbody id="topsales-data-body">
                                    <!-- Dinamik olarak doldurulacak -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <!-- End Top Selling -->

            </div>
        </div><!-- End Left side columns -->
        <!-- Right side columns -->
        <div class="col-lg-4">

            <!-- Recent Activity -->
            <div class="card">
                
                <div class="card-body">
                    <h5 class="card-title">Recent Activity</h5>

                    <div class="activity">

                        <div class="activity-item d-flex">
                            <div class="activite-label">32 min</div>
                            <i class='bi bi-circle-fill activity-badge text-success align-self-start'></i>
                            <div class="activity-content">
                                Quia quae rerum <a href="#" class="fw-bold text-dark">explicabo officiis</a> beatae
                            </div>
                        </div><!-- End activity item-->

                        <div class="activity-item d-flex">
                            <div class="activite-label">56 min</div>
                            <i class='bi bi-circle-fill activity-badge text-danger align-self-start'></i>
                            <div class="activity-content">
                                Voluptatem blanditiis blanditiis eveniet
                            </div>
                        </div><!-- End activity item-->

                        <div class="activity-item d-flex">
                            <div class="activite-label">2 hrs</div>
                            <i class='bi bi-circle-fill activity-badge text-primary align-self-start'></i>
                            <div class="activity-content">
                                Voluptates corrupti molestias voluptatem
                            </div>
                        </div><!-- End activity item-->

                        <div class="activity-item d-flex">
                            <div class="activite-label">1 day</div>
                            <i class='bi bi-circle-fill activity-badge text-info align-self-start'></i>
                            <div class="activity-content">
                                Tempore autem saepe <a href="#" class="fw-bold text-dark">occaecati voluptatem</a> tempore
                            </div>
                        </div><!-- End activity item-->

                        <div class="activity-item d-flex">
                            <div class="activite-label">2 days</div>
                            <i class='bi bi-circle-fill activity-badge text-warning align-self-start'></i>
                            <div class="activity-content">
                                Est sit eum reiciendis exercitationem
                            </div>
                        </div><!-- End activity item-->

                        <div class="activity-item d-flex">
                            <div class="activite-label">4 weeks</div>
                            <i class='bi bi-circle-fill activity-badge text-muted align-self-start'></i>
                            <div class="activity-content">
                                Dicta dolorem harum nulla eius. Ut quidem quidem sit quas
                            </div>
                        </div><!-- End activity item-->

                    </div>

                </div>
            </div><!-- End Recent Activity -->
            <!-- News & Updates Traffic -->
            <div class="card">
                <div class="card-body pb-0">
                    <h5 class="card-title">News &amp; Updates</h5>

                    <div class="news">
                        <!-- Blog verileri buraya eklenecek -->
                    </div><!-- End sidebar recent posts-->

                </div>
            </div><!-- End News & Updates -->

        </div><!-- End Right side columns -->

    </div>
</section>

@section Scripts {
    <script>
        const loadSalesData = async () => {
            try {
                const res = await fetch('http://localhost:5211/api/Report/GetProductOfferStatusReport');
                if (!res.ok) {
                    throw new Error('Veri çekme işlemi başarısız oldu');
                }

                const data = await res.json();
                console.log("Gelen Veri", data);

                const salesDataBody = document.getElementById('sales-data-body');
                
                data.forEach(sale => {
                    const row = document.createElement('tr');

                    // Tablo hücrelerini oluştur ve doldur
                    const td1 = document.createElement('td');
                    td1.innerText = `${sale.productId}`;
                    const td2 = document.createElement('td');
                    td2.innerText = `${sale.firstName} ${sale.lastName}`;
                    const td3 = document.createElement('td');
                    td3.innerText = `${sale.productName}`;
                    const td4 = document.createElement('td');
                    td4.innerText = `${sale.price}`;
                    const td5 = document.createElement('td');
                    td5.innerText = `${sale.offerStatus}`;

                    console.log("TD1", td1);

                    row.append(td1);
                    row.append(td2);
                    row.append(td3);
                    row.append(td4);
                    row.append(td5);
                    salesDataBody.append(row);
                });
            } catch (err) {
                console.error('Satış verilerini çekerken hata oluştu:', err);
                alert('Satış verilerini yüklerken bir hata oluştu. Lütfen daha sonra tekrar deneyin.');
            }
        };

        window.addEventListener("load", () => { loadSalesData(); });
    </script>

    <script>
        const topLoadSalesData = async () => {
            try {
                const res = await fetch('http://localhost:5211/api/Report/GetProductTopSelling');
                if (!res.ok) {
                    throw new Error('Veri çekme işlemi başarısız oldu');
                }

                const data = await res.json();
                console.log("Gelen Veri", data);

                const topSalesDataBody = document.getElementById('topsales-data-body');

                data.forEach(topSale => {
                    const row = document.createElement('tr');

                    // Tablo hücrelerini oluştur ve doldur
                    const td1 = document.createElement('td');
                    td1.innerText = `${topSale.views}`;
                    const td2 = document.createElement('td');
                    td2.innerText = `${topSale.productName}`;
                    const td3 = document.createElement('td');
                    td3.innerText = `${topSale.price}`;
                    const td4 = document.createElement('td');
                    td4.innerText = `${topSale.amount}`;
                    const td5 = document.createElement('td');
                    td5.innerText = `${topSale.totalPrice}`;

                    row.append(td1);
                    row.append(td2);
                    row.append(td3);
                    row.append(td4);
                    row.append(td5);
                    topSalesDataBody.append(row);
                });
            } catch (err) {
                console.error('Satış verilerini çekerken hata oluştu:', err);
                alert('Satış verilerini yüklerken bir hata oluştu. Lütfen daha sonra tekrar deneyin.');
            }
        };

        window.addEventListener("load", () => { topLoadSalesData(); });
    </script>

    <script>
        const LoadBlogsData = async () => {
            try {
                const res = await fetch('http://localhost:5211/api/Blog/GetAllBlogs');
                if (!res.ok) {
                    throw new Error('Veri çekme işlemi başarısız oldu');
                }

                const data = await res.json();
                console.log("Gelen Veri", data);

                const newsContainer = document.querySelector('.news');
                newsContainer.innerHTML = ''; // Öncelikle mevcut içerikleri temizle

                data.forEach(blog => {
                    // Post item divini oluştur
                    const postItem = document.createElement('div');
                    postItem.className = 'post-item clearfix';

                    // Görseli oluştur
                    const img = document.createElement('img');
                    img.src = blog.image; // Blog'dan gelen resim URL'si
                    img.alt = blog.title; // Alternatif metin olarak başlık
                    postItem.appendChild(img);

                    // Başlık kısmını oluştur
                    const title = document.createElement('h4');
                    const titleLink = document.createElement('a');
                    titleLink.href = '#'; // Burada başlık için bir link verirseniz
                    titleLink.innerText = blog.title; // Başlık
                    title.appendChild(titleLink);
                    postItem.appendChild(title);

                    // İçerik kısmını oluştur
                    const content = document.createElement('p');
                    content.innerText = blog.content; // İçerik
                    postItem.appendChild(content);

                    // Oluşturulan post item'ı haber konteynerine ekle
                    newsContainer.appendChild(postItem);
                });
            } catch (err) {
                console.error('Blog verilerini çekerken hata oluştu:', err);
                alert('Blog verilerini yüklerken bir hata oluştu. Lütfen daha sonra tekrar deneyin.');
            }
        };

        window.addEventListener("load", () => { LoadBlogsData(); });
    </script>

    <!-- jQuery ve AJAX -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
}











